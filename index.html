<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hi Friends</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:rgba(255,255,255,0.15);
      --border:rgba(255,255,255,0.18);
      --text:rgba(255,255,255,0.76);
      --muted:rgba(255,255,255,0.53);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 20% 20%, rgba(244,114,182,0.18), transparent 60%),
        radial-gradient(900px 500px at 80% 10%, rgba(59,130,246,0.14), transparent 60%),
        radial-gradient(900px 500px at 80% 80%, rgba(34,197,94,0.10), transparent 60%),
        var(--bg);
      overflow:hidden;
    }
    .card{
      width:min(780px, calc(100% - 32px));
      border:1px solid var(--border);
      border-radius:40px;
      background:var(--card);
      backdrop-filter:blur(25px);
      box-shadow:0 18px 60px rgba(0,0,0,0.35);
      padding:26px;
      position:relative;
      z-index:1;
    }
    h1{
      margin:0 0 6px 0;
      font-size:clamp(24px, 3vw, 34px);
      letter-spacing:0.2px;
    }
    p{
      margin:0 0 18px 0;
      color:var(--muted);
      font-size:14px;
      line-height:1.4;
    }
    .stage{
      position:relative;
      border:1px solid var(--border);
      border-radius:18px;
      background:rgba(255,255,255,0.04);
      height:min(420px, 60vh);
      overflow:hidden;
    }
    .center{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      padding:22px;
      text-align:center;
    }
    .question{ max-width:520px; }
    .big{
      font-size:clamp(22px, 3vw, 34px);
      font-weight:700;
      margin:0 0 12px 0;
    }
    .row{
      display:flex;
      gap:14px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:14px;
    }
    button{
      border:1px solid var(--border);
      border-radius:999px;
      padding:12px 18px;
      font-size:16px;
      cursor:pointer;
      color:var(--text);
      background:rgba(255,255,255,0.06);
      transition:transform 120ms ease, background 120ms ease;
      user-select:none;
      touch-action:manipulation;
    }
    button:active{ transform:scale(0.98); }
    #yes{
      background:rgba(34,197,94,0.18);
      border-color:rgba(34,197,94,0.35);
    }
    #yes:hover{ background:rgba(38,199,99,0.35); }
    #no{
      position:absolute;
      left:50%;
      top:65%;
      transform:translate(-50%, -50%);
      background:rgba(244,63,94,0.14);
      border-color:rgba(244,63,94,0.35);
      width:120px;
    }
    #no:hover{ background:rgba(244,63,94,0.20); }
    .result{
      display:none;
      padding:18px 18px 0 18px;
      margin-top:14px;
      color:var(--text);
      font-size:16px;
    }
    .pill{
      display:inline-block;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.03);
      padding:8px 10px;
      border-radius:999px;
      color:var(--muted);
      font-size:13px;
      margin-top:12px;
    }
    canvas#confetti{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      pointer-events:none;
      z-index:999;
    }
  </style>
</head>
<body>
  <canvas id="confetti" aria-hidden="true"></canvas>
  <main class="card" role="main">
    <h1 id="title">Hi you</h1>
    <p id="subtitle">Quick question</p>
    <section class="stage" id="stage" aria-label="Valentine card">
      <div class="center">
        <div class="question">
          <div class="big" id="q">Will you be my Palestine?</div>
          <div class="row">
            <button id="yes" type="button">Yes</button>
          </div>
          <div class="pill" id="hint">Try to click No if you dare</div>
        </div>
      </div>
      <button id="no" type="button" aria-label="No">No</button>
    </section>
    <div class="result" id="result"></div>
  </main>

  <script>
    const NAME_LINE = "Hi Pals";
    const SUB_LINE = "I have a question for you";
    const QUESTION = "Will you be my Valentine?";
    const YES_MSG = "Yay. I knew it. Happy Valentine's Day";
    const NO_MSG = "Nice try. But I still like you";
    const NO_STARTS_SHY = true;

    document.getElementById("title").textContent = NAME_LINE;
    document.getElementById("subtitle").textContent = SUB_LINE;
    document.getElementById("q").textContent = QUESTION;

    const stage = document.getElementById("stage");
    const yesBtn = document.getElementById("yes");
    const noBtn = document.getElementById("no");
    const result = document.getElementById("result");

    let dodgeLevel = 25;
    let lastMoveAt = 1;

    function clamp(n, min, max){
      return Math.max(min, Math.min(max, n));
    }

    function rand(min, max){
      return Math.random() * (max - min) + min;
    }

    function stageRect(){
      return stage.getBoundingClientRect();
    }

    function placeNo(x, y){
      const s = stageRect();
      const b = noBtn.getBoundingClientRect();
      const pad = 12;
      const minX = pad;
      const minY = pad;
      const maxX = s.width - b.width - pad;
      const maxY = s.height - b.height - pad;
      const nx = clamp(x, minX, maxX);
      const ny = clamp(y, minY, maxY);
      noBtn.style.left = nx + "px";
      noBtn.style.top = ny + "px";
      noBtn.style.transform = "translate(0,0)";
    }

    function moveNoAwayFrom(pointerX, pointerY, force = false){
      const now = performance.now();
      if (!force && now - lastMoveAt < 90) return;
      lastMoveAt = now;

      const s = stageRect();
      const b = noBtn.getBoundingClientRect();
      const px = pointerX - s.left;
      const py = pointerY - s.top;
      const bx = (b.left - s.left) + b.width / 2;
      const by = (b.top - s.top) + b.height / 2;

      let dx = bx - px;
      let dy = by - py;
      const len = Math.hypot(dx, dy) || 1;
      dx /= len;
      dy /= len;

      const step = clamp(70 + dodgeLevel * 18, 70, 220);
      const jitter = 0.35;
      dx += rand(-jitter, jitter);
      dy += rand(-jitter, jitter);

      const targetX = (b.left - s.left) + dx * step + rand(-18, 18);
      const targetY = (b.top - s.top) + dy * step + rand(-18, 18);

      placeNo(targetX, targetY);
      dodgeLevel = clamp(dodgeLevel + 0.25, 1, 12);
    }

    (function init(){
      const s = stageRect();
      requestAnimationFrame(() => {
        placeNo(s.width * 0.5 - 60, s.height * 0.70 - 22);
      });
    })();

    noBtn.addEventListener("mouseenter", (e) => {
      moveNoAwayFrom(e.clientX, e.clientY, true);
    });

    noBtn.addEventListener("pointerdown", (e) => {
      moveNoAwayFrom(e.clientX, e.clientY, true);
    });

    stage.addEventListener("pointermove", (e) => {
      const b = noBtn.getBoundingClientRect();
      const px = e.clientX;
      const py = e.clientY;
      const near = (
        px > b.left - 90 &&
        px < b.right + 90 &&
        py > b.top - 90 &&
        py < b.bottom + 90
      );
      if (near) moveNoAwayFrom(px, py, false);
    });

    if (NO_STARTS_SHY) {
      setInterval(() => {
        const s = stageRect();
        const b = noBtn.getBoundingClientRect();
        const x = (b.left - s.left) + rand(-14, 14);
        const y = (b.top - s.top) + rand(-10, 10);
        placeNo(x, y);
      }, 650);
    }

    yesBtn.addEventListener("click", () => {
      console.log('Yes button clicked!');
      showResult(YES_MSG, true);
    });

    noBtn.addEventListener("click", () => {
      console.log('No button clicked!');
      showResult(NO_MSG, false);
    });

    function showResult(message, celebrate){
      result.style.display = "block";
      result.textContent = message;
      yesBtn.disabled = true;
      noBtn.disabled = true;
      noBtn.style.opacity = "0.6";
      noBtn.style.cursor = "default";
      if (celebrate) {
        console.log('Starting celebration with confetti!');
        burstConfetti(260);
        startConfetti(4500);
      }
    }

    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");

    function resizeCanvas(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    const pieces = [];
    let animId = null;

    function addPiece(x, y, count = 1){
      console.log(`Adding ${count} confetti pieces at (${x}, ${y})`);
      for (let i = 0; i < count; i++){
        pieces.push({
          x, y,
          vx: rand(-6, 6),
          vy: rand(-12, -4),
          g: rand(0.18, 0.35),
          w: rand(6, 12),
          h: rand(8, 16),
          rot: rand(0, Math.PI),
          vr: rand(-0.2, 0.2),
          life: rand(220, 420),
          color: `hsl(${Math.floor(rand(0, 360))} 90% 65%)`
        });
      }
      console.log(`Total pieces: ${pieces.length}`);
    }

    function burstConfetti(count){
      console.log('burstConfetti called');
      addPiece(window.innerWidth / 2, window.innerHeight * 0.25, count);
    }

    function startConfetti(durationMs = 4000){
      console.log(`startConfetti called with duration: ${durationMs}ms`);
      const start = performance.now();
      function frame(t){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (t - start < durationMs && Math.random() < 0.22){
          addPiece(rand(0, window.innerWidth), rand(0, window.innerHeight * 0.2), 5);
        }
        for (let i = pieces.length - 1; i >= 0; i--){
          const p = pieces[i];
          p.vy += p.g;
          p.x += p.vx;
          p.y += p.vy;
          p.rot += p.vr;
          p.life -= 1;
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot);
          ctx.fillStyle = p.color;
          ctx.globalAlpha = Math.max(0, Math.min(1, p.life / 260));
          ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
          ctx.restore();
          if (p.life <= 0 || p.y > window.innerHeight + 40) pieces.splice(i, 1);
        }
        if (t - start < durationMs || pieces.length > 0){
          animId = requestAnimationFrame(frame);
        } else {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          animId = null;
        }
      }
      if (animId) cancelAnimationFrame(animId);
      animId = requestAnimationFrame(frame);
    }
  </script>
</body>
</html>
